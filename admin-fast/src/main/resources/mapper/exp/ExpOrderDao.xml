<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.os.modules.exp.dao.ExpOrderDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.os.modules.exp.entity.ExpOrderEntity" id="expOrderMap">
        <result property="id" column="id"/>
        <result property="deptId" column="dept_id"/>
        <result property="ordCode" column="ord_code"/>
        <result property="goodsId" column="goods_id"/>
        <result property="ordNum" column="ord_num"/>
        <result property="packingId" column="packing_id"/>
        <result property="freight" column="freight"/>
        <result property="advance" column="advance"/>
        <result property="advanceIn" column="advance_in"/>
        <result property="settleCode" column="settle_code"/>
        <result property="settleId" column="settle_id"/>
        <result property="delivery" column="delivery"/>
        <result property="remark" column="remark"/>
        <result property="userId" column="user_id"/>
        <result property="shipper" column="shipper"/>
        <result property="shipperTel" column="shipper_tel"/>
        <result property="receiver" column="receiver"/>
        <result property="receiverTel" column="receiver_tel"/>
        <result property="status" column="status"/>
        <result property="deliverDate" column="deliver_date"/>
        <result property="createTime" column="create_time"/>
        <result property="goods_name" column="goodsName"/>
        <result property="dept_name" column="deptName"/>
        <result property="settle_name" column="settleName"/>
        <result property="packing_name" column="packingName"/>
        <result property="realname" column="realname"/>
    </resultMap>

    <select id="selectOrderPage" resultMap="expOrderMap">
        SELECT
            eo.*, eg.goods_name,
            ed.dept_name,
            es.settle_name,
            ep.packing_name,
            su.realname
        FROM
            exp_order eo
        LEFT JOIN exp_goods eg ON eo.goods_id = eg.id
        LEFT JOIN exp_packing ep ON eo.packing_id = ep.id
        LEFT JOIN exp_department ed ON eo.dept_id = ed.id
        LEFT JOIN exp_settle es ON eo.settle_code = es.settle_code
        LEFT JOIN sys_user su ON eo.user_id = su.user_id
        WHERE 1 = 1
        <if test="param.deliverDate!=null and param.deliverDate != ''">
            and eo.deliver_date = #{param.deliverDate}
        </if>
        <if test="param.status!=null and param.status != ''">
            and eo.status = #{param.status}
        </if>
        <if test="param.settleCode!=null and param.settleCode != ''">
            and eo.settle_code = #{param.settleCode}
        </if>
        <if test="param.deptId !=null and param.deptId != ''">
            and eo.dept_id = #{param.deptId}
        </if>
        <if test="param.userId!=null and param.userId!= ''">
            and eo.user_id = #{param.userId}
        </if>
    </select>

    <select id="getResume" resultType="int">
        SELECT
            SUM(t.advance + t.freight + t.delivery)
        FROM
            (
                SELECT
                    SUM(eo.advance) advance,
                    SUM(eo.freight) freight,
                    SUM(delivery) delivery
                FROM
                    exp_order eo
                WHERE
                    eo.`status` = #{param.status}
                    and eo.deliver_date = #{param.deliverDate}
                <if test="param.deptId !=null and param.deptId != ''">
                    and eo.dept_id = #{param.deptId}
                </if>
                <if test="param.userId!=null and param.userId!= ''">
                    and eo.user_id = #{param.userId}
                </if>
                GROUP BY
                    eo.deliver_date
            ) t
    </select>

</mapper>
